<!DOCTYPE html>
<!--   https://coworker-a215c-default-rtdb.firebaseio.com/ -->
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pilgrim Emergency Information</title>

  <!-- üî• FIREBASE SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // üî¥ REPLACE WITH YOUR REAL CONFIG
    const firebaseConfig = {
      apiKey: "AIzaSyAql2b6h8Wd0d1MAhsz3HPB51A5yXNMByg",
      authDomain: "coworker.firebaseapp.com",
      projectId: "coworker"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const params = new URLSearchParams(window.location.search);
    const braceletId = params.get("id");

    if (!braceletId) {
      document.body.innerHTML = "Invalid bracelet ID";
      throw new Error("Missing ID");
    }

    const ref = doc(db, "pilgrims", braceletId);
    const snap = await getDoc(ref);

    if (!snap.exists()) {
      document.body.innerHTML = "Pilgrim not found";
      throw new Error("Not found");
    }

    const pilgrim = snap.data();

    // Populate UI after load
    window.addEventListener("DOMContentLoaded", () => {

      // Profile
      document.getElementById("full_name").innerText = pilgrim.full_name;
      document.getElementById("age").innerText = pilgrim.age ? pilgrim.age + " years" : "";
      document.getElementById("gender").innerText = pilgrim.gender || "";
      document.getElementById("nationality").innerText = pilgrim.nationality || "";
      document.getElementById("blood_type").innerText = pilgrim.blood_type || "";

      if (pilgrim.photo_url) {
        document.getElementById("photo").src = pilgrim.photo_url;
        document.getElementById("photo").style.display = "block";
      }

      // Group
      document.getElementById("group_agency").innerText = pilgrim.group_agency || "";

      // Makkah Hotel
      if (pilgrim.makkah_hotel?.name) {
        document.getElementById("makkah_hotel").innerText = pilgrim.makkah_hotel.name;
      }
      if (pilgrim.makkah_hotel?.room) {
        document.getElementById("makkah_room").innerText = pilgrim.makkah_hotel.room;
      }
      if (pilgrim.makkah_hotel?.location) {
        const { lat, lng } = pilgrim.makkah_hotel.location;
        document.getElementById("makkah_map").href =
          `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;
      }

      // Madinah Hotel
      if (pilgrim.madinah_hotel?.name) {
        document.getElementById("madinah_hotel").innerText = pilgrim.madinah_hotel.name;
      }
      if (pilgrim.madinah_hotel?.room) {
        document.getElementById("madinah_room").innerText = pilgrim.madinah_hotel.room;
      }
      if (pilgrim.madinah_hotel?.location) {
        const { lat, lng } = pilgrim.madinah_hotel.location;
        document.getElementById("madinah_map").href =
          `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;
      }

      // Medical
      document.getElementById("conditions").innerText = pilgrim.medical?.conditions || "None";
      document.getElementById("allergies").innerText = pilgrim.medical?.allergies || "None";
      document.getElementById("medications").innerText = pilgrim.medical?.medications || "None";

      // Emergency Contact
      if (pilgrim.emergency_contact) {
        document.getElementById("em_name").innerText = pilgrim.emergency_contact.name || "";
        document.getElementById("em_relation").innerText = pilgrim.emergency_contact.relationship || "";
        document.getElementById("em_phone").innerText = pilgrim.emergency_contact.phone || "";
        document.getElementById("call_btn").href = "tel:" + pilgrim.emergency_contact.phone;
      }

      document.getElementById("bracelet_id").innerText = braceletId;
    });
  </script>

  <!-- üé® YOUR STYLES (UNCHANGED CORE DESIGN) -->
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #667eea, #764ba2);
      padding: 20px;
    }
    .container {
      max-width: 800px;
      background: white;
      margin: auto;
      border-radius: 10px;
      overflow: hidden;
    }
    .header {
      background: #dc3545;
      color: white;
      text-align: center;
      padding: 20px;
    }
    .profile {
      text-align: center;
      padding: 20px;
    }
    .photo {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      object-fit: cover;
      display: none;
    }
    .section {
      padding: 20px;
      border-top: 1px solid #eee;
    }
    .label {
      font-weight: bold;
      color: #555;
    }
    .value {
      margin-bottom: 10px;
    }
    .call {
      display: block;
      background: #28a745;
      color: white;
      text-align: center;
      padding: 15px;
      border-radius: 8px;
      font-size: 20px;
      text-decoration: none;
    }
  </style>
</head>

<body>
  <div class="container">

    <div class="header">
      <h1>üö® Emergency Information</h1>
    </div>

    <div class="profile">
      <img id="photo" class="photo" />
      <h2 id="full_name"></h2>
      <div id="age"></div>
      <div id="gender"></div>
      <div id="nationality"></div>
      <div id="blood_type" style="color:red;font-weight:bold;"></div>
    </div>

    <div class="section">
      <div class="label">Group Agency</div>
      <div class="value" id="group_agency"></div>
    </div>

    <div class="section">
      <div class="label">Makkah Hotel</div>
      <div id="makkah_hotel"></div>
      <div id="makkah_room"></div>
      <a id="makkah_map" target="_blank">üìç Directions</a>
    </div>

    <div class="section">
      <div class="label">Madinah Hotel</div>
      <div id="madinah_hotel"></div>
      <div id="madinah_room"></div>
      <a id="madinah_map" target="_blank">üìç Directions</a>
    </div>

    <div class="section">
      <div class="label">Medical Conditions</div>
      <div id="conditions"></div>
      <div class="label">Allergies</div>
      <div id="allergies"></div>
      <div class="label">Medications</div>
      <div id="medications"></div>
    </div>

    <div class="section">
      <div class="label">Emergency Contact</div>
      <div id="em_name"></div>
      <div id="em_relation"></div>
      <div id="em_phone"></div>
      <a id="call_btn" class="call">üìû Call Now</a>
    </div>

    <div class="section" style="text-align:center;color:#666;">
      Bracelet ID: <span id="bracelet_id"></span>
    </div>

  </div>
</body>
</html>
